
= render partial: "partials/logged_in_header"
/ SECONDARY HEADER BAR
.container.full-width.blue-bg.no-padding.white.dashboard-header
  .row
    .col-md-6.col-xs-12.align-center
      .single-line.no-opacity
      %h1 HERE ARE YOUR THINGS
    .col-md-1.col-sm-4.col-xs-4.align-center
      %a{:href => "packing_supplies_requests/new.html"}
        .service-box
          .service-icon
            %i.fa.fa-dropbox
          .service-desc
            %h6
              Order Boxes
    .col-md-1.col-sm-4.col-xs-4.align-center
      %a{:href => "box_requests/new.html"}
        .service-box
          .service-icon
            %i.fa.fa-truck
          .service-desc
            %h6
              New
              %br/ 
              Pickup 
    .col-md-1.col-sm-4.col-xs-4.align-center
      = link_to faq_path do
        .service-box
          .service-icon
            %i.fa.fa-question-circle.fa-3x
          .service-desc
            %h6
              Have a
              %br>/
              Question?
%br/
%br/
%br/

// Main Body Content
.container.inventory
  .row
    .col-md-10.col-md-offset-1
      .row
        .col-md-8
          .div#storage-empty.hidden.width-90
            %a{:href => "box_requests/new.html"}
              %img{:src => "https://s3.amazonaws.com/storage_rails_app_dev/images/nothing-in-storage.png", :alt => ""}/ 
          %form#pickup-form{:action => ""}
            / Boxes At Home
            .row
              %h2
                %span.items-count#boxes-at-home= @boxes_at_home
                Items Awaiting Pickup: 
                =link_to "Add to Pickup", {:controller => "packing_supplies_requests", :action => "new"}, :class => "pull-right"
              .double-line
              - 3.times do
                .col-md-6.col-sm-6.col-xs-6.inventory-entries.pickup-entry
                  .inner
                    .avatar
                      %img.img-responsive{:alt => "", :src => "https://s3.amazonaws.com/harnessthecrowd/SpaceYouNeed/box-default.jpg"}/
                    %h4 Standard Box
                    %p.subtitle.box-subtitle.col-md-12.col-sm-12.col-xs-12 Click "request pickup" when you're done packing.
                    %input.hidden{:name => "vehicle", :type => "checkbox", :value => "\#{}"}/
                     
          %br/
          %br/
    
          / Existing Inventory Row 
          %form#delivery-form{:action => ""}
            .row
              %h2
                %span.items-count#items-in-storage #{@num_storage_items}
                / %span.items-count#items-in-storage 0
                Items In Storage
              .double-line
              - @storage_items.each do |storage_item|
                .col-md-6.col-sm-6.col-xs-6.inventory-entries.delivery-entry{:id => "#{storage_item.id}"}
                  .inner
                    .avatar
                      = image_tag(storage_item.image.url, class: "img-responsive")

                    %h4= storage_item.title
                    %p.subtitle.box-subtitle.col-md-12.col-sm-12.col-xs-12= storage_item.description
              .col-md-12.col-sm-12.col-xs-12.align-left
                %br/
                =link_to "Want More Boxes? Schedule a dropoff.", {:controller => "packing_supplies_requests", :action => "new"}

        .col-md-4.inventory-sidebar
          .row.sidebar-txtentry.light-blue-bg
            .innert
              %h5 Notifications
              .single-line
              %ul
                %li
                  %span.order-item You have an pickup schedules for Thursday, September 15
                %li
                  %span.order-item You currently have #{@boxes_at_home} boxes at home, waiting to be picked up.
          %br/
          .row.sidebar-txtentry.bg-gray
            .inner
              %h5 Inventory
              .single-line
              %ul.no-list
                %li
                  %span.order-item Standard Boxes
                  %span.pull-right 4
                %li
                  %span.order-item Wardrobe Boxes
                  %span.pull-right 1
                %li
                  %span.order-item Couches
                  %span.pull-right 1
          .row
            .boxed-gray.continue-button
              %button#pickup-button.btn.btn-primary.gray-bg{:disabled => false, :type => "button"} Request Pickup
              %button#delivery-button.btn.btn-primary.blue-bg.blue-bg-hover{:disabled => "true", :type => "button"} Request Delivery
%br/
%br/
%br/
= render partial: "partials/footer"



:javascript
  var numDeliveryItems = 0;
  var numPickupItems = 0;

  $(document).ready(function(){
    var atHome = parseInt($("#boxes-at-home").html());
    var inStorage =parseInt($("#items-in-storage").html());
    console.log(atHome);
    console.log(inStorage);
    if (atHome == 0){
      $("#pickup-form").addClass("hidden");
    }
    if (inStorage == 0){
      $("#delivery-form").addClass("hidden");
    }
    if (atHome == 0 && inStorage == 0){
      $("#storage-empty").toggleClass("hidden");
    }

  });

  // Delivery Entry Selected
  $(".delivery-entry").click(function() {
    $(this).toggleClass("selected-item");

      if($(this).hasClass("selected-item")){
      numDeliveryItems = numDeliveryItems + 1;
        $('input:first', this).prop('checked', true);

    } else {
      numDeliveryItems = numDeliveryItems - 1;
      $('input:first', this).prop('checked', false);

    }
    console.log("numDeliveryItems:" + numDeliveryItems);

    if (numDeliveryItems == 0) $("#delivery-button").attr("disabled", "disabled");
    else {
      console.log("Delivery BUTTON REMOVING DISABLED");
      $("#delivery-button").removeAttr("disabled"); 
      $(".pickup-entry").removeClass("selected-item");
      // $("#pickup-button").attr("disabled", "disabled");
      numPickupItems = 0;  
     } 
  });

  // Pick Up Entry Selected
  $(".pickup-entry").click(function() {
    $(this).toggleClass("selected-item");
      $('input:first', this).prop('checked', true);

      if($(this).hasClass("selected-item")){
      numPickupItems = numPickupItems + 1;
    } else {
      numPickupItems = numPickupItems - 1;
    }
    console.log("numPickupItems:" + numPickupItems);

    if (numPickupItems == 0) console.log("the pickup button would be disabled here bc there are no items selected");
    else {
      console.log("pickup BUTTON REMOVING DISABLED");
      $("#pickup-button").removeAttr("disabled");   
      $(".delivery-entry").removeClass("selected-item");
      $("#delivery-button").attr("disabled", "disabled");
      numDeliveryItems = 0;
     } 
  });

  $("#pickup-button").click(function(event){
      event.preventDefault();
     var selectedEntries = $(".selected-item.pickup-entry");
     console.log(selectedEntries.size());
     var destinationURL = "/pickup_requests/new/" + selectedEntries.size();
     window.location.href = destinationURL;
  });

  $("#delivery-button").click(function(){
     event.preventDefault();
     var selectedEntries = $(".selected-item.delivery-entry");
     var itemsList = "";
     var numItems = 0;
     selectedEntries.each(function(){
      var elemId = $(this).attr('id');
      if(numItems == 0){
        itemsList = elemId;
      } else{
        itemsList = itemsList + "," + elemId;
      }
      numItems += 1;
     });
     console.log(selectedEntries.size());
     console.log(itemsList);

     var destinationURL = "/delivery_requests/new/" + itemsList;
     window.location.href = destinationURL;
  });

  
