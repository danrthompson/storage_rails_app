
= render partial: "partials/logged_in_header"   
= render partial: "partials/blue_bar", locals:{mainText:"Item Delivery", dashboard:true, faq:true}
= render :partial => 'partials/nudge_icon'

/ Section: ITEM SELECTION
%section#about.home-section.text-center
  .heading-about.marginbot-20
    .container
      .row
        .col-lg-8.col-lg-offset-2
          .section-heading
            %h2 Delivery Information

  .container
    .row
      .div
        = form_for(@delivery_request) do |f| 
          / Address Info Section
          .row
            .col-md-8.col-md-offset-2
              .row
                = fields_for @user do |field|
                  = render partial: "partials/delivery_addr_date", locals: {field:field, f:f, id:"datepicker"}
                  = render partial: "partials/delivery_date_time", locals: {field:field, f:f,  id:"pickup_datepicker", select_id:"delivery_time"}
        
          %br/ 
          %br/ 
          %br/ 
          .section-heading
            %h2.no-margin What Shall We Deliver?

          .row.inventory  
            .col-md-8.col-md-offset-2
              %h2.align-center  
                (these are your items in storage)
              /   / %p.pull-right.half-opacity Click items to select them for delivery
              / .double-line
              - @storage_items.each do |storage_item|
                .col-md-6.col-sm-6.col-xs-6.inventory-entries.delivery-entry{:id => "#{storage_item.id}"}
                  .inner
                    .crop-mask
                      .crop-mask-img-wrapper
                        = image_tag(storage_item.image_url, class: "img-responsive")
                      .item-description
                        %p.subtitle.box-subtitle
                          = storage_item.get_description
                        / = link_to "(click here to edit entry)", {:action => "edit", "id"=>"#{storage_item.id}"}, class:"align-center description-edit-boxed"
                    .checkbox-wrapper
                      %input.pull-left.form-control.delivery-checkbox{:type => "checkbox", required:true, id:"#{storage_item.id}"}/
                      %h4.storage-item-title.pull-left= storage_item.get_title


                / .col-md-6.col-sm-6.col-xs-6.inventory-entries.delivery-entry{:id => "#{storage_item.id}"}
                /   .inner
                /     .crop-mask
                /       = image_tag(storage_item.image_url, class: "img-responsive")

                /     %h4.storage-item-title= storage_item.get_title
                /     %p.subtitle.box-subtitle.col-md-12.col-sm-12.col-xs-12= storage_item.get_description
            %br/
          %br/ 
          %br/  
          %br/ 
          .row  
            .col-md-10.col-md-offset-1
              .row.charges-box
                .col-md-10.col-md-offset-1.confirm-elem.light-blue-bg
                  %h5 Delivery Summary
                  %ul
                    / - @requested_boxes.each do |requested_item|
                    /   %li.delivery-line-item
                    /     = requested_item.title
                    /     %i.pull-right
                    /       $
                    /       %span.delivery-item-price 
                    /         #{requested_item.delivery_price}
                    / %br/ 
                    %li.half-opacity.delivery-line-item
                      Baseline Delivery Fee
                      %span.pull-right
                        $
                        %span.delivery-item-price 
                          10
                  .single-line
                  %ul
                    %li.heavy-font
                      Subtotal
                      %span#order-subtotal.pull-right $00.00
                      %p#not-month.hidden 0
              %br/ 
          .hidden-form
            = f.text_field :user_id, class:"form-control", id:"delivery-list"

          / Bottom Buttons Section
          .col-md-8.col-md-offset-2
            .row
              .col-md-4.bottom-buttons
                .boxed-gray.continue-button
                  = link_to storage_items_path, class:"white" do
                    %button.btn.btn-primary.blue-bg.gray-bg{:type => "button"} Back


                  / %a{:href => "user-newbox.html", :style => "color: white;"} Back
              .col-md-4.col-md-offset-4.bottom-buttons.charges-box
                .boxed-gray.continue-button
                  %button.btn.btn-primary.blue-bg.blue-bg-hover#continue-btn{ disabled: true}
                    = f.submit "Confirm Delivery"

= render :partial => "partials/footer"


:javascript
  $(document).ready(function() { 
    valAddrDelivery("#validator-id", "#continue-btn", "#pickup_datepicker", "#delivery_time");

    $(".form-control").on('input', function() {
      valAddrDelivery("#validator-id", "#continue-btn", "#pickup_datepicker", "#delivery_time")
    });

    sumItemList(".delivery-item-price", "#order-subtotal");
  });

  var requestedItemsList = "";
  $(".delivery-checkbox").click(function(){
    console.log("test");
    requestedItemsList = "";
    $(".delivery-checkbox").each(function(){
      
      if($(this).prop('checked')){
        var checkedId = $(this).attr("id");
        requestedItemsList += checkedId+",";
      }
    });
    requestedItemsList = requestedItemsList.substring(0, requestedItemsList.length-1);
    console.log("internal test: " + requestedItemsList);
    $("#delivery-list").val(requestedItemsList);
  });

  


